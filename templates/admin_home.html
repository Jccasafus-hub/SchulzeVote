{% extends "base_admin.html" %}
{% block title %}SchulzeVote Admin · Painel{% endblock %}

{% block content %}
  {% set secret_qs = request.args.get('secret','') %}
  <h1>Painel do Administrador</h1>
  <p class="muted">Atalhos rápidos de administração, downloads e dados brutos.</p>

  <div class="card">
    <h3 style="margin:0 0 8px 0">Configuração</h3>
    <div class="row admin-links">
      <a class="btn" href="/admin/candidates{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}">Candidatos &amp; prazo</a>
      <a class="btn" href="/admin/election_meta{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}">Metadados da votação</a>
      <a class="btn" href="/admin/assign_ui{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}">Atribuir chaves (UI)</a>
      <a class="btn" href="/admin/audit_preview{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}">Auditoria (preview)</a>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px 0">Downloads (ZIP)</h3>
    <div class="row" style="gap:10px; align-items:flex-end">
      <a class="btn" href="/admin/backup_zip{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}">Backup completo (ZIP)</a>

      <form class="row" action="/admin/backup_zip_eid" method="get" style="gap:8px; align-items:flex-end">
        {% if secret_qs %}<input type="hidden" name="secret" value="{{ secret_qs }}">{% endif %}
        <label>EID<br><input type="text" name="eid" placeholder="ex.: teste-2025-01" required></label>
        <button class="btn" type="submit">Backup por EID (ZIP)</button>
      </form>

      <form class="row" action="/admin/export_audit_bundle" method="get" style="gap:8px; align-items:flex-end">
        {% if secret_qs %}<input type="hidden" name="secret" value="{{ secret_qs }}">{% endif %}
        <label>EID (opcional)<br><input type="text" name="eid" placeholder="em branco = atual"></label>
        <button class="btn" type="submit">Pacote de auditoria (ZIP)</button>
      </form>
    </div>
    <p class="muted" style="margin-top:8px">Os downloads incluem cédulas, log de auditoria e arquivos de configuração conforme disponível.</p>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px 0">Dados brutos (JSON)</h3>
    <div class="row" style="gap:10px; flex-wrap:wrap">
      <a class="btn" href="/admin/keys_list{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}">Chaves (JSON)</a>
      <a class="btn" href="/admin/pool_list{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}">Pool (JSON)</a>
      <a class="btn" href="/admin/users_list{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}">Usuários (JSON)</a>
      <a class="btn" href="/admin/trash_list{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}">Lixeira (JSON)</a>
      <a class="btn" href="/admin/audit_raw{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}" title="Linhas de auditoria da eleição atual">Auditoria (raw)</a>
      <a class="btn" href="/admin/ballots_raw{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}" title="Cédulas da eleição atual">Cédulas (raw)</a>
    </div>
    <p class="muted" style="margin-top:8px">Dica: use os JSONs para inspeções rápidas e exportações sob medida.</p>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px 0">Público</h3>
    <div class="row">
      <a class="btn" href="/public/elections" target="_blank" rel="noopener">Lista de votações (JSON)</a>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px 0">Sessão</h3>
    <div class="row">
      <a class="btn ghost" href="/admin/logout{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}">Sair</a>
      <a class="btn" href="/{% if secret_qs %}?secret={{ secret_qs|urlencode }}{% endif %}">Ir para o site público</a>
    </div>
  </div>

  <div class="row" style="margin-top:14px">
    <a class="btn ghost" href="/">Voltar ao início público</a>
  </div>
{% endblock %}
