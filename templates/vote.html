{% extends "base.html" %}
{% block title %}SchulzeVote · Votar{% endblock %}

{% block content %}
<div class="wrap">
  <h1>Votar</h1>

  <div class="card" style="max-width:720px">
    <form method="POST" action="/vote" onsubmit="return confirm('Confirmar envio do voto?');">
      <div style="display:grid;gap:12px">
        <!-- Chave de votação -->
        <div>
          <label>Minha chave de votação
            <input id="vkey" type="password" name="voter_id" required inputmode="latin-prose" placeholder="ex.: ABCD-1234-EFGH">
          </label>
          <label style="display:inline-flex;align-items:center;gap:8px;margin-left:8px;user-select:none">
            <input type="checkbox" onclick="toggleKey()"> Mostrar chave
          </label>
        </div>

        <div class="sep"></div>

        <!-- Opções especiais -->
        <div style="display:flex;gap:18px;flex-wrap:wrap;align-items:center">
          <label style="display:flex;align-items:center;gap:8px;user-select:none">
            <input type="radio" name="special_vote" value="" checked onchange="toggleSpecial(false)"> Ranking normal
          </label>
          <label style="display:flex;align-items:center;gap:8px;user-select:none">
            <input type="radio" name="special_vote" value="BLANK" onchange="toggleSpecial(true)"> <span style="padding:2px 8px;border-radius:10px;border:1px dashed #f59e0b;color:#f59e0b">Voto em Branco</span>
          </label>
          <label style="display:flex;align-items:center;gap:8px;user-select:none">
            <input type="radio" name="special_vote" value="NULL" onchange="toggleSpecial(true)"> <span style="padding:2px 8px;border-radius:10px;border:1px dashed #ef4444;color:#ef4444">Voto Nulo</span>
          </label>
        </div>

        <!-- Ranking numérico -->
        <div id="rankBox">
          <p class="muted" style="margin:0">Digite o <b>número da preferência</b> para cada candidato que você quiser ordenar (1 = melhor). Deixe em branco se não quiser ranquear aquele candidato.</p>
          <div style="margin-top:10px;display:grid;gap:8px">
            {% for c in candidates %}
              <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
                <input type="hidden" name="cand_{{ loop.index0 }}" value="{{ c }}">
                <label style="min-width:240px"><b>{{ c }}</b></label>
                <input class="rankInput" type="number" min="1" name="rank_{{ loop.index0 }}" placeholder="nº da preferência">
              </div>
            {% endfor %}
          </div>
        </div>

        <div class="sep"></div>

        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn accent" type="submit">Enviar voto</button>
          <a class="btn" href="/">Início</a>
        </div>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts_extra %}
<script>
function toggleKey(){
  const el = document.getElementById('vkey');
  el.type = (el.type === 'password') ? 'text' : 'password';
}
function toggleSpecial(disableRanks){
  const inputs = document.querySelectorAll('.rankInput');
  inputs.forEach(i => {
    i.disabled = disableRanks;
    if (disableRanks) i.value = '';
  });
}
</script>
{% endblock %}
