{% extends "base.html" %}
{% block title %}Resultados · SchulzeVote{% endblock %}

{% block content %}
<div class="wrap">
  <h1>Resultados</h1>

  <div class="card">
    <div style="display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between">
      <div>
        <p style="margin:0">EID: <b>{{ election_id }}</b></p>
        {% if election_meta %}
          <p style="margin:4px 0 0 0">
            <b>{{ election_meta.title }}</b><br>
            {% if election_meta.date and election_meta.time %}
              {{ election_meta.date }} {{ election_meta.time }} ({{ election_meta.tz or 'America/Sao_Paulo' }})
            {% endif %}
          </p>
        {% endif %}
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <a class="btn" href="/public/{{ election_id }}/audit">Abrir auditoria</a>
        <a class="btn ghost" href="/">Início</a>
      </div>
    </div>
  </div>

  {% if empty %}
    <div class="card">
      <p class="muted">Nenhum voto registrado ainda para esta votação.</p>
    </div>
  {% else %}
    <div class="card">
      <p style="margin:0 0 8px 0">Total de votos (ponderados): <b>{{ total_votos }}</b></p>
      <ol style="margin-top:8px">
        {% for c in ranking %}
          <li>{{ c }}</li>
        {% endfor %}
      </ol>
    </div>
  {% endif %}

  {% if candidates and pairwise and strength %}
    <div class="card">
      <h3 style="margin-top:0">Diagnóstico (debug)</h3>
      <details open>
        <summary><b>Confrontos par-a-par (P)</b></summary>
        <div style="overflow:auto;margin-top:8px">
          <table style="border-collapse:collapse;border:1px solid #1f242c">
            <thead>
              <tr>
                <th style="padding:6px 10px;border:1px solid #1f242c">A \ B</th>
                {% for b in candidates %}
                  <th style="padding:6px 10px;border:1px solid #1f242c">{{ b }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for a in candidates %}
                <tr>
                  <th style="padding:6px 10px;border:1px solid #1f242c;text-align:left">{{ a }}</th>
                  {% for b in candidates %}
                    {% if a == b %}
                      <td style="padding:6px 10px;border:1px solid #1f242c;text-align:center;opacity:.6">—</td>
                    {% else %}
                      <td style="padding:6px 10px;border:1px solid #1f242c;text-align:center">{{ pairwise[a][b] }}</td>
                    {% endif %}
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </details>

      <details style="margin-top:12px">
        <summary><b>Forças de caminho (S)</b></summary>
        <div style="overflow:auto;margin-top:8px">
          <table style="border-collapse:collapse;border:1px solid #1f242c">
            <thead>
              <tr>
                <th style="padding:6px 10px;border:1px solid #1f242c">A \ B</th>
                {% for b in candidates %}
                  <th style="padding:6px 10px;border:1px solid #1f242c">{{ b }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for a in candidates %}
                <tr>
                  <th style="padding:6px 10px;border:1px solid #1f242c;text-align:left">{{ a }}</th>
                  {% for b in candidates %}
                    {% if a == b %}
                      <td style="padding:6px 10px;border:1px solid #1f242c;text-align:center;opacity:.6">—</td>
                    {% else %}
                      <td style="padding:6px 10px;border:1px solid #1f242c;text-align:center">{{ strength[a][b] }}</td>
                    {% endif %}
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </details>

      <p class="muted" style="margin-top:10px">Para exibir esta seção, abra com <code>?debug=1</code>.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
