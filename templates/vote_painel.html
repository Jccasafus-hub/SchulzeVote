<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Votar · Preferências</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:system-ui,Arial,sans-serif;max-width:860px;margin:40px auto;padding:0 16px}
    input,button{padding:8px;border:1px solid #ddd;border-radius:8px}
    button{background:#111;color:#fff;cursor:pointer}
    table{border-collapse:collapse} td,th{border:1px solid #ddd;padding:6px 8px}
    .muted{color:#666}
    .bar{display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:10px}
    .chip{background:#f5f5f5;border:1px solid #ddd;border-radius:20px;padding:6px 10px;font-size:12px}
    .warn{background:#fff8e6;border:1px solid #ffd28a;border-radius:8px;padding:10px;margin-bottom:12px}
  </style>
</head>
<body>
  <div class="bar">
    <h1 style="margin:0">Votar</h1>
    <div class="chip">
      EID: <b>{{ eid }}</b>
    </div>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <ul>
        {% for cat,msg in messages %}
          <li><b>{{ cat }}</b>: {{ msg }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  {% if not session_vkey %}
    <div class="warn">
      <b>Chave não validada.</b> Volte para a etapa anterior:
      <a href="/vote">inserir chave</a>.
    </div>
  {% endif %}

  <form method="POST" action="/vote/panel">
    <p class="muted">Defina a ordem de preferência (1 = mais preferido). Deixe em branco para não ranquear.</p>
    <table>
      <tr><th>Candidato</th><th>Rank</th></tr>
      {% for c in candidates %}
        <tr>
          <td>{{ c }}</td>
          <td>
            {% if "Branco" in c or "Nulo" in c %}
              <small>Use “Voto em Branco/Nulo” abaixo</small>
            {% else %}
              <input name="rank_{{ loop.index0 }}" style="width:80px" pattern="\d*">
              <input type="hidden" name="cand_{{ loop.index0 }}" value="{{ c }}">
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </table>

    <p>Ou escolha voto especial:
      <label><input type="radio" name="special_vote" value=""> (nenhum)</label>
      <label><input type="radio" name="special_vote" value="BLANK"> Branco</label>
      <label><input type="radio" name="special_vote" value="NULL"> Nulo</label>
    </p>

    <button type="submit">Enviar voto</button>
  </form>

  <p style="margin-top:14px"><a href="/">Início</a></p>
</body>
</html>
